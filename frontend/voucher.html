<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizar Voucher</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .voucher-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .voucher-content {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 20px;
            max-width: 90%;
            max-height: 90vh;
            overflow: auto;
        }
        #voucherImage {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
        }
        #voucherPDF {
            width: 100%;
            height: 80vh;
            border: none;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="voucher-container">
        <div class="voucher-content">
            <div class="text-center mb-3">
                <h4><i class="bi bi-file-earmark"></i> Visualizar Voucher</h4>
            </div>
            <div id="loading" class="text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando...</span>
                </div>
                <p class="mt-3">Cargando archivo...</p>
            </div>
            <div id="content" style="display: none;"></div>
            <div id="error" style="display: none;" class="alert alert-danger text-center">
                <i class="bi bi-exclamation-triangle"></i>
                <p class="mb-0">No se pudo cargar el archivo</p>
            </div>
            <div class="text-center mt-3">
                <button onclick="window.close()" class="btn btn-secondary">
                    <i class="bi bi-x-circle"></i> Cerrar
                </button>
                <a id="btnDownload" href="#" download class="btn btn-primary" style="display: none;">
                    <i class="bi bi-download"></i> Descargar
                </a>
            </div>
        </div>
    </div>

    <script>
        // Obtener el nombre del archivo de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const filename = urlParams.get('file') || window.location.pathname.split('/').pop();
        
        // Construir la URL del archivo
        const baseUrl = window.location.origin;
        const voucherUrl = `${baseUrl}/api/reportes/voucher/${filename}`;
        
        // Detectar tipo de archivo
        const extension = filename.split('.').pop().toLowerCase();
        const isPDF = extension === 'pdf';
        const isImage = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);
        
        const loading = document.getElementById('loading');
        const content = document.getElementById('content');
        const error = document.getElementById('error');
        const btnDownload = document.getElementById('btnDownload');
        
        if (isPDF) {
            // Mostrar PDF completo en el navegador
            loading.style.display = 'none';
            content.style.display = 'block';
            content.innerHTML = `<iframe id="voucherPDF" src="${voucherUrl}" style="width: 100%; height: 90vh; border: none;"></iframe>`;
            btnDownload.href = voucherUrl;
            btnDownload.style.display = 'inline-block';
        } else if (isImage) {
            // Mostrar imagen completa en el navegador
            loading.style.display = 'none';
            content.style.display = 'block';
            const img = document.createElement('img');
            img.id = 'voucherImage';
            img.src = voucherUrl;
            img.alt = 'Voucher';
            img.style.maxWidth = '100%';
            img.style.height = 'auto';
            img.style.display = 'block';
            img.style.margin = '0 auto';
            img.onload = () => {
                // Asegurar que la imagen se vea completa
                img.style.maxHeight = '90vh';
            };
            img.onerror = () => {
                content.style.display = 'none';
                error.style.display = 'block';
            };
            content.appendChild(img);
            btnDownload.href = voucherUrl;
            btnDownload.style.display = 'inline-block';
        } else {
            // Tipo no soportado
            loading.style.display = 'none';
            error.style.display = 'block';
            error.innerHTML = `
                <i class="bi bi-exclamation-triangle"></i>
                <p class="mb-0">Tipo de archivo no soportado para visualizaci√≥n</p>
                <a href="${voucherUrl}" download class="btn btn-primary mt-3">
                    <i class="bi bi-download"></i> Descargar archivo
                </a>
            `;
        }
    </script>
</body>
</html>

